alert http any any -> any any (msg:"CORELIGHT - C2 heartbeat from Manjusaka attack framework (Detection method 1) - no alert"; flow:established,to_server; noalert; http.method; content:"GET"; http.content_len; pcre:"/^2$/"; flowbits:set,CORELIGHT.Manjusaka.ping; reference:url,https://corelight.com/blog/detecting-manjusaka-c2-framework; reference:url,https://blog.talosintelligence.com/2022/08/manjusaka-offensive-framework.html; classtype:trojan-activity; sid:3000030; rev:1; metadata:created_at 2022_09_08, updated_at 2022_09_08;)
alert http any any -> any any (msg:"CORELIGHT - C2 heartbeat from Manjusaka attack framework (Detection method 1)"; flow:established,to_client; flowbits:isset,CORELIGHT.Manjusaka.ping; http.response_body; content:"|1A 1A 6E 04 29|"; depth:5; threshold: type limit, track by_both, seconds 300, count 1; reference:url,https://corelight.com/blog/detecting-manjusaka-c2-framework; reference:url,https://blog.talosintelligence.com/2022/08/manjusaka-offensive-framework.html; classtype:trojan-activity; sid:3000031; rev:1; metadata:created_at 2022_09_08, updated_at 2022_09_08;)
alert http any any -> any any (msg:"CORELIGHT - C2 heartbeat from Manjusaka attack framework (Detection method 2)"; flow:established,to_server; http.method; content:"GET"; http.uri; content:".png"; endswith; http.content_len; byte_test:0,>,1,0,string,dec; http.accept_lang; content:"zh-CN"; http.user_agent; content:"Mozilla"; startswith; threshold: type limit, track by_both, seconds 300, count 1; reference:url,https://corelight.com/blog/detecting-manjusaka-c2-framework; reference:url,https://blog.talosintelligence.com/2022/08/manjusaka-offensive-framework.html; classtype:trojan-activity; sid:3000032; rev:1; metadata:created_at 2022_09_15, updated_at 2022_09_15;)
alert http any any -> any any (msg:"CORELIGHT - C2 exfiltration from Manjusaka attack framework (Detection method 3) - no alert"; flow:established,to_server; noalert; flowbits:isnotset,CORELIGHT.Manjusaka.ping; http.method; content:"GET"; http.content_len; byte_test:0,>=,2,0,string,dec; flowbits:set,CORELIGHT.Manjusaka.exfil; reference:url,https://corelight.com/blog/detecting-manjusaka-c2-framework; reference:url,https://blog.talosintelligence.com/2022/08/manjusaka-offensive-framework.html; classtype:trojan-activity; sid:3000033; rev:1; metadata:created_at 2022_09_15 updated_at 2022_09_15;)
alert http any any -> any any (msg:"CORELIGHT - C2 exfiltration from Manjusaka attack framework (Detection method 3)"; flow:established,to_client; flowbits:isset,CORELIGHT.Manjusaka.exfil; http.response_body; content:"|1A 1A 6E 04 29|"; depth:5; reference:url,https://corelight.com/blog/detecting-manjusaka-c2-framework; reference:url,https://blog.talosintelligence.com/2022/08/manjusaka-offensive-framework.html; classtype:trojan-activity; sid:3000034; rev:1; metadata:created_at 2022_09_15, updated_at 2022_09_15;)
alert http any any -> any any (msg:"CORELIGHT - C2 exfiltration from Manjusaka attack framework (Detection method 4a)"; flow:established,to_server; http.user_agent; content:"Mozilla/5.0 (Windows NT 8.0\; WOW64\; rv:58.0) Gecko/20120102 Firefox/58.0"; threshold: type limit, track by_both, seconds 300, count 1; reference:url,https://corelight.com/blog/detecting-manjusaka-c2-framework; reference:url,https://blog.talosintelligence.com/2022/08/manjusaka-offensive-framework.html; classtype:trojan-activity; sid:3000035; rev:1; metadata:created_at 2022_09_15, updated_at 2022_09_15;)
alert http any any -> any any (msg:"CORELIGHT - C2 exfiltration from Manjusaka attack framework (Detection method 4b)"; flow:established,to_server; http.user_agent; content:"Mozilla/5.0 (Windows NT 8.0\; WOW64\; rv:40.0) Gecko"; threshold: type limit, track by_both, seconds 300, count 1; reference:url,https://corelight.com/blog/detecting-manjusaka-c2-framework; reference:url,https://blog.talosintelligence.com/2022/08/manjusaka-offensive-framework.html; classtype:trojan-activity; sid:3000036; rev:1; metadata:created_at 2022_09_15, updated_at 2022_09_15;)
